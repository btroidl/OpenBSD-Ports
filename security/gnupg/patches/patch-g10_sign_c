gpg: Report BEGIN_* status before examining the input.
https://dev.gnupg.org/rG960877b10f42ba664af4fb29130a3ba48141e64a

Index: g10/sign.c
--- g10/sign.c.orig
+++ g10/sign.c
@@ -1034,10 +1034,7 @@ sign_file (ctrl_t ctrl, strlist_t filenames, int detac
   int multifile = 0;
   u32 duration=0;
   pt_extra_hash_data_t extrahash = NULL;
-  char peekbuf[32];
-  int  peekbuflen = 0;
 
-
   pfx = new_progress_context ();
   afx = new_armor_context ();
   memset (&zfx, 0, sizeof zfx);
@@ -1095,14 +1092,6 @@ sign_file (ctrl_t ctrl, strlist_t filenames, int detac
           goto leave;
 	}
 
-      peekbuflen = iobuf_ioctl (inp, IOBUF_IOCTL_PEEK, sizeof peekbuf, peekbuf);
-      if (peekbuflen < 0)
-        {
-          peekbuflen = 0;
-          if (DBG_FILTER)
-            log_debug ("peeking at input failed\n");
-        }
-
       handle_progress (pfx, inp, fname);
     }
 
@@ -1260,7 +1249,7 @@ sign_file (ctrl_t ctrl, strlist_t filenames, int detac
       int compr_algo = opt.compress_algo;
 
       if (!opt.explicit_compress_option
-          && is_file_compressed (peekbuf, peekbuflen))
+          && is_file_compressed (inp))
         {
           if (opt.verbose)
             log_info(_("'%s' already compressed\n"), fname? fname: "[stdin]");
